# 💫 麦麦失忆插件 (Amnesia Plugin)

让麦麦选择性"失忆"，忘记之前的对话~

## 📝 功能简介

这个插件可以让管理员控制麦麦"忘记"对话记忆，实际上是清除聊天的消息历史记录。

### 核心功能

- 💫 **完全失忆** - 忘记所有对话（完全断片）
- 🌀 **选择性失忆** - 忘记最近N条对话
- ⏰ **时间倒流** - 忘记N小时前的对话
- 💥 **彻底失忆** - 清除所有数据，包括人物印象、群组信息、日记等（v1.1.0新增）
- 🔐 **权限控制** - 只有管理员才能让麦麦失忆

## 🎮 使用方法

### 命令格式

```
/失忆 [子命令] [参数]
```

也可以使用：`/忘记`、`/断片`、`/amnesia`、`/forget`、`/clear`

### 子命令

| 命令 | 英文 | 参数 | 说明 |
|------|------|------|------|
| `全部` | `all` | 无 | 让麦麦忘记当前聊天的所有对话 |
| `完全` | `total` | `确认` | ⚠️ 让麦麦彻底失忆，清除所有数据（需二次确认） |
| `最近` | `recent` | [数量] | 让麦麦忘记最近N条对话（默认10条） |
| `之前` | `before` | [小时] | 让麦麦忘记N小时前的对话（默认24小时） |
| `帮助` | `help` | 无 | 显示使用帮助 |

### 使用示例

```bash
# 清除当前聊天的所有记忆
/失忆 全部
/forget all

# 忘记最近的对话
/失忆 最近 20
/amnesia recent 20

# 忘记48小时前的对话
/失忆 之前 48
/forget before 48

# 完全失忆（需二次确认）
/失忆 完全
# 查看警告后，确认执行：
/失忆 完全 确认

# 查看帮助
/失忆 帮助
```

## 💥 完全失忆模式（v1.1.0新增）

这是最彻底的失忆模式，会清除麦麦的**所有记忆数据**，包括：

### 清除范围

- ✅ **所有聊天记录** - Messages表
- ✅ **聊天流信息** - ChatStreams表
- ✅ **个人印象** - PersonInfo表（认识的所有人）
- ✅ **群组信息** - GroupInfo表（群组印象、话题）
- ✅ **长期记忆** - MemoryChest表
- ✅ **记忆冲突** - MemoryConflict表
- ✅ **表达风格** - Expression表（学习到的说话风格）
- ✅ **动作记录** - ActionRecords表
- ✅ **统计数据** - local_store.json
- ✅ **风格学习** - learnt_grammar、learnt_style

### 保留内容

- 🔒 系统配置
- 🔒 插件功能
- 🔒 表情包资源
- 🔒 UUID（唯一标识）
- 🔒 日记数据（由日记插件独立管理）

### 使用步骤

1. 发送 `/失忆 完全`
2. 查看警告信息，了解清除范围
3. 确认后发送 `/失忆 完全 确认`
4. 等待清除完成，查看简化统计报告

**统计报告说明**：
- 用户界面只显示总计数字（避免消息过长被截断）
- 详细统计数据会记录在日志中
- **重要**：统计报告消息本身也会被清除，不留记录（真正的完全失忆）
- 示例输出：
  ```
  💫✨ *完全失忆完成* ✨💫

  我...我是谁？这里是哪里？

  📊 清除了 XXX 项记忆数据

  麦麦现在是全新的状态了...
  一切都要重新开始呢~ 💫
  ```

## ⚙️ 配置说明

### 权限配置

在 `config.toml` 中配置有权限让麦麦失忆的用户：

```toml
[plugin]
enabled = true
permission = ["1334431750", "123456789"]  # 管理员的用户ID列表
```

## ⚠️ 注意事项

### 普通失忆 vs 完全失忆

| 特性 | 全部（all） | 完全（total） |
|------|------------|--------------|
| 作用范围 | 当前聊天 | 所有数据 |
| 清除对象 | 聊天消息 | 所有记忆 |
| 其他聊天 | 不影响 | 全部清除 |
| 人物印象 | 保留 | 清除 |
| 群组信息 | 保留 | 清除 |
| 二次确认 | 无 | 需要 |

### 警告

- ⚠️ **不可逆操作** - 失忆后无法恢复
- ⚠️ **数据丢失** - 所有历史记忆将永久丢失
- ⚠️ **谨慎使用** - 建议只给可信任的管理员权限

## 🎭 使用场景

- 🎭 **角色扮演** - 重新开始新的角色扮演场景
- 🔄 **测试调试** - 测试对话时清除历史记录
- 🧹 **定期清理** - 定期清理旧对话节省存储空间
- 🎪 **娱乐互动** - "麦麦，把昨天的黑历史忘掉！"
- 🔥 **完全重置** - 将麦麦恢复到初始状态

## 📌 版本历史

### v1.2.0 (2025-11-18)
- ✨ **新增**：统计报告消息本身也不会被记录（真正的完全失忆）
- 🔧 发送统计报告后自动清除该消息记录
- 💾 确保完全失忆后数据库完全清空，不留任何痕迹
- 📝 更新文档说明

### v1.1.1 (2025-11-18)
- 🔧 优化完全失忆的统计报告显示
- 📊 简化用户界面输出，只显示总计数字（避免消息被截断）
- 📝 详细统计数据移至日志记录
- 🐛 修复统计报告过长导致QQ消息截断的问题

### v1.1.0 (2025-11-17)
- ✨ 新增"完全失忆"模式，支持清除所有记忆数据
- ✨ 新增二次确认机制，防止误操作
- ✨ 新增配置项控制是否清除日记
- ✨ 新增详细的清除统计报告
- 📝 更新文档和帮助信息
- 🎨 优化提示文本和交互体验

### v1.0.0 (2025-11-17)
- 🎉 首次发布（改造自 context_clear_plugin）
- ✨ 更有趣的提示文本和交互体验
- 🌐 支持中英文命令
- 🎨 重新设计为"失忆"主题

## 📜 许可证

MIT License

## 👥 作者

MaiBot Community
